{
  "asset_type": "Endpoint",
  "channel": "ESCU",
  "confidence": "medium",
  "correlation_rule": {
    "notable": {
      "nes_fields": "dest, user, process",
      "rule_description": "This search looks for flags passed to schtasks.exe on the command-line that indicate a job is being scheduled on a remote system.",
      "rule_title": "Schtasks scheduling job on remote system"
    },
    "risk": {
      "risk_object": "dest",
      "risk_object_type": [
        "system"
      ],
      "risk_score": 50
    },
    "suppress": {
      "suppress_fields": "dest,cmdline",
      "suppress_period": "28800s"
    }
  },
  "creation_date": "2016-09-13",
  "data_metadata": {
    "data_source": [
      "Endpoint Intel"
    ],
    "data_sourcetypes": [
      "XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"
    ],
    "providing_technologies": [
      "Carbon Black Response",
      "CrowdStrike Falcon",
      "Sysmon",
      "Tanium",
      "Ziften"
    ]
  },
  "eli5": "The search looks for execution of schtasks.exe with parameters that indicate a task is being scheduled on a remote host. Schtasks.exe is a native windows program that is used to schedule tasks on local or remote systems. Attackers often leverage this capability to schedule the execution of commands or malicious executables on remote systems.",
  "how_to_implement": "To successfully implement this search you need to be ingesting logs with both the process name and command-line from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.",
  "known_false_positives": "Administrators may create jobs on remote systems, but this activity is usually limited to a small set of hosts or users. It is important to validate and investigate as appropriate.",
  "maintainers": [
    {
      "company": "Splunk",
      "email": "davidd@splunk.com",
      "name": "David Dorsey"
    }
  ],
  "mappings": {
    "cis20": [
      "CIS 3"
    ],
    "kill_chain_phases": [
      "Actions on Objectives"
    ],
    "mitre_attack": [
      "Persistence",
      "Lateral Movement",
      "Execution",
      "Scheduled Task",
      "Remote Services"
    ],
    "nist": [
      "PR.IP"
    ]
  },
  "modification_date": "2017-09-15",
  "original_authors": [
    {
      "company": "Splunk",
      "email": "davidd@splunk.com",
      "name": "David Dorsey"
    }
  ],
  "scheduling": {
    "cron_schedule": "0 * * * *",
    "earliest_time": "-70m@m",
    "latest_time": "-10m@m"
  },
  "search": "(sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR tag=process) process=*schtasks.exe* cmdline=\"*/create*\" cmdline=\"* /s *\" | stats count min(_time) as firstTime max(_time) as lastTime by dest, user, process, cmdline | `ctime(firstTime)`| `ctime(lastTime)`",
  "search_description": "This search looks for flags passed to schtasks.exe on the command-line that indicate a job is being scheduled on a remote system.",
  "search_id": "1297fb80-f42a-4b4a-9c8a-88c066237cf6",
  "search_name": "Schtasks scheduling job on remote system",
  "search_type": "detection",
  "security_domain": "endpoint",
  "spec_version": 1,
  "version": "1.0"
}
