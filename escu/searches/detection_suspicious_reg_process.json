{
  "asset_type": "Endpoint",
  "channel": "ESCU",
  "confidence": "medium",
  "correlation_rule": {
    "notable": {
      "nes_fields": "dest, user, process",
      "rule_description": "The system $dest$ had reg.exe process run not initiated by a user.",
      "rule_title": "Suspicious reg.exe process detected on $dest$"
    },
    "risk": {
      "risk_object": "dest",
      "risk_object_type": [
        "system"
      ],
      "risk_score": 80
    },
    "suppress": {
      "suppress_fields": "dest, user",
      "suppress_period": "14400s"
    }
  },
  "creation_date": "2017-10-11",
  "data_metadata": {
    "data_source": [
      "Endpoint Intel"
    ],
    "data_sourcetypes": [
      "XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"
    ],
    "providing_technologies": [
      "Carbon Black Response",
      "CrowdStrike Falcon",
      "Sysmon",
      "Tanium",
      "Ziften"
    ]
  },
  "eli5": "This search looks for the execution of reg.exe with a parent process of cmd.exe. It then executes a subsearch looking for those cmd.exe processes with a parent that is not explorer.exe. It then joins those two searches to make sure that the reg.exe process is a grandchild of the non explorer.exe process. The search will return the number of such instances and the first and last time this activity has been seen on each endpoint and user.",
  "how_to_implement": "To successfully implement this search, you need to ingest logs with the process name and command-line, as well as the parent process name from your endpoints. If you are using Sysmon, you will need to have a Splunk Universal Forwarder on each endpoint that you want to collect the data on. You will also need to deploy the Sysmon TA on these endpoints and on your search head. You must have at least version 6.0.4 of the Sysmon TA.",
  "known_false_positives": "It's possible for system administrators to write scripts that exhibit this behavior. If this is the case, the search will need to be modified to filter them out.",
  "maintainers": [
    {
      "company": "Splunk",
      "email": "davidd@splunk.com",
      "name": "David Dorsey"
    }
  ],
  "mappings": {
    "cis20": [
      "CIS 8"
    ],
    "kill_chain_phases": [
      "Actions on Objectives"
    ],
    "mitre_attack": [
      "Defense Evasion",
      "Modify Registry",
      "Disabling Security Tools"
    ],
    "nist": [
      "DE.CM"
    ]
  },
  "modification_date": "2017-10-23",
  "original_authors": [
    {
      "company": "Splunk",
      "email": "davidd@splunk.com",
      "name": "David Dorsey"
    }
  ],
  "references": [
    "https://car.mitre.org/wiki/CAR-2013-03-001"
  ],
  "scheduling": {
    "cron_schedule": "0 * * * *",
    "earliest_time": "-70m@m",
    "latest_time": "-10m@m"
  },
  "search": "process=reg.exe parent_process=*cmd.exe [search process=cmd.exe parent_process!=*explorer.exe | fields process_id | dedup process_id | rename process_id as parent_process_id] | stats count min(_time) as firstTime max(_time) as lastTime by dest, user, process, cmdline | `ctime(firstTime)` | `ctime(lastTime)`",
  "search_description": "This search looks for reg.exe being launched from a command prompt not started by the user. When a user launches cmd.exe, the parent process is usually explorer.exe. This search filters out those instances.",
  "search_id": "a6b3ab4e-dd77-4213-95fa-fc94701995e0",
  "search_name": "Suspicious Reg.exe Process",
  "search_type": "detection",
  "security_domain": "endpoint",
  "spec_version": 1,
  "version": "1.0"
}
