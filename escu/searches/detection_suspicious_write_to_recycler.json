{
  "asset_type": "Windows",
  "channel": "ESCU",
  "confidence": "medium",
  "correlation_rule": {
    "notable": {
      "nes_fields": "dest, file_name, process",
      "rule_description": "The process $process$ on $dest$ wrote $file_name$ to the Recycle Bin.",
      "rule_title": "Suspicious process $process$ wrote to the Recycle Bin on $dest$"
    },
    "risk": {
      "risk_object": "dest",
      "risk_object_type": [
        "system"
      ],
      "risk_score": 70
    },
    "suppress": {
      "suppress_fields": "dest",
      "suppress_period": "86400s"
    }
  },
  "creation_date": "2018-01-08",
  "data_metadata": {
    "data_source": [
      "Endpoint Intel"
    ],
    "data_sourcetypes": [
      "XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"
    ],
    "providing_technologies": [
      "Sysmon"
    ]
  },
  "eli5": "This search uses data on file writes captured via Sysmon to watch for writes to the Recycle Bin by processes other than explorer.exe. The search looks for event code 11 in the Sysmon events, which indicates a file-creation event. Next, it looks for files created with a path that includes the string \"$Recycle.Bin\" by processes other than explorer.exe, which is the process responsible for copying files to the Recycle Bin on delete. It will report the system where the activity occurred, the path to which the file was written, the process responsible for the write, and the times it first and last saw this activity.",
  "how_to_implement": "You need to be ingesting logs with both the process name and command-line from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.",
  "known_false_positives": "Because the Recycle Bin is a hidden folder in modern versions of Windows, it would be unusual for a process other than explorer.exe to write to it. Incidents should be investigated as appropriate.",
  "maintainers": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "mappings": {
    "cis20": [
      "CIS 8"
    ],
    "mitre_attack": [
      "Collection",
      "Data Staged"
    ],
    "nist": [
      "DE.CM"
    ]
  },
  "modification_date": "2018-01-08",
  "original_authors": [
    {
      "company": "Splunk",
      "email": "rvaldez@splunk.com",
      "name": "Rico Valdez"
    }
  ],
  "scheduling": {
    "cron_schedule": "0 * * * *",
    "earliest_time": "-70m@m",
    "latest_time": "-10m@m"
  },
  "search": "(sourcetype=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational OR tag=process) EventCode=11 file_path=*$Recycle.Bin* process!=explorer.exe | stats count min(_time) as firstTime max(_time) as lastTime by dest, Image, file_path | `ctime(firstTime)`| `ctime(lastTime)`",
  "search_description": "This search detects writes to the recycle bin by a process other than explorer.exe.",
  "search_id": "b5541828-8ffd-4070-9d95-b3da4de924cb",
  "search_name": "Suspicious writes to windows Recycle Bin",
  "search_type": "detection",
  "security_domain": "endpoint",
  "spec_version": 1,
  "status": "production",
  "team_notes": "",
  "version": "1.0"
}
